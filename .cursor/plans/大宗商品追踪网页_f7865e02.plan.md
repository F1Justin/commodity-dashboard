---
name: å¤§å®—å•†å“è¿½è¸ªç½‘é¡µ
overview: æ„å»ºä¸€ä¸ªæœ¬åœ°è¿è¡Œçš„å¤§å®—å•†å“ä»·æ ¼è¿½è¸ªç³»ç»Ÿï¼Œä½¿ç”¨ Python FastAPI åç«¯ + SQLite æ•°æ®åº“ + Next.js/ECharts å‰ç«¯ï¼Œé€šè¿‡å®šæ—¶ä»»åŠ¡é‡‡é›†å›½å†…å¤–æœŸè´§åŠå®è§‚æ•°æ®ã€‚
todos:
  - id: backend-setup
    content: æ­å»º FastAPI åç«¯æ¡†æ¶ï¼Œé…ç½® APScheduler å®šæ—¶ä»»åŠ¡
    status: completed
  - id: database-init
    content: åˆ›å»º SQLite æ•°æ®åº“åŠè¡¨ç»“æ„ï¼ˆå«æº¢ä»·ç‡å†å²è¡¨ï¼‰
    status: completed
  - id: fetchers
    content: å®ç°å„æ•°æ®æºé‡‡é›†å™¨ï¼ˆAkShare ä¸ºä¸»ï¼Œå«æ±‡ç‡æ¥å£ï¼‰
    status: completed
  - id: calculator-module
    content: å®ç°æº¢ä»·ç‡è®¡ç®—å™¨æ ¸å¿ƒæ¨¡å—ï¼ˆç†è®ºä»·/æº¢ä»·ç‡/é‡‘é“¶æ¯”/é“œé‡‘æ¯”ï¼‰
    status: completed
  - id: api-endpoints
    content: å®ç° REST APIï¼ˆsnapshot/calculator/normalized/exportï¼‰
    status: completed
  - id: frontend-setup
    content: æ­å»º Next.js å‰ç«¯æ¡†æ¶
    status: completed
  - id: calculator-page
    content: å®ç°æº¢ä»·ç‡è®¡ç®—å™¨é¡µé¢ï¼ˆæ•°æ®è¡¨æ ¼ + ä¿¡å·ç¯é¢æ¿ï¼‰
    status: completed
  - id: normalized-charts
    content: å®ç°å½’ä¸€åŒ–å¯¹æ¯”å›¾è¡¨ï¼ˆè´µé‡‘å±/æœ‰è‰²/èƒ½æº/å†œäº§å“åˆ†ç»„ï¼‰
    status: completed
  - id: export-feature
    content: å®ç°æ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼ˆCSV/Excelï¼‰
    status: completed
  - id: dashboard-page
    content: å®ç°ä»ªè¡¨ç›˜é¦–é¡µï¼ˆæŒ‡æ ‡å¡ç‰‡ + æº¢ä»·ç‡ä»ªè¡¨ç›˜ï¼‰
    status: completed
  - id: docker-deploy
    content: ç¼–å†™ Docker é…ç½®ï¼Œå®ç°ä¸€é”®éƒ¨ç½²
    status: completed
isProject: false
---

# å¤§å®—å•†å“æˆ˜æƒ…å®¤ - æ¶æ„æ–¹æ¡ˆè®¨è®º

## ä¸€ã€å¯¹ç°æœ‰æ¶æ„çš„è¯„ä¼°

### ä¼˜ç‚¹

- **æŠ€æœ¯æ ˆé€‰å‹åˆç†**ï¼šFastAPI + Next.js + ECharts æ˜¯æˆç†Ÿç»„åˆ
- **æ•°æ®æºæ€è·¯æ­£ç¡®**ï¼šæ–°æµªæœŸè´§æ¥å£ç¡®å®æ˜¯å›½å†…æœŸè´§æ•°æ®çš„å¸¸ç”¨æ¥æº
- **Docker éƒ¨ç½²æ–¹ä¾¿**ï¼šä¾¿äºè¿ç§»å’Œå¤‡ä»½

### éœ€è¦æ”¹è¿›/ç»†åŒ–çš„åœ°æ–¹


| é—®é¢˜        | å»ºè®®                           |
| --------- | ---------------------------- |
| Celery è¿‡é‡ | æœ¬åœ°è¿è¡Œç”¨ APScheduler å³å¯ï¼Œå‡å°‘ä¾èµ–å¤æ‚åº¦ |
| æ•°æ®æºå•ä¸€     | æ–°æµªæ¥å£ä¸ç¨³å®šï¼Œéœ€è¦å¤‡ç”¨æ–¹æ¡ˆ               |
| ç¼ºå°‘éƒ¨åˆ†æ•°æ®æº   | CPIã€æ±½æŸ´æ²¹é›¶å”®ä»·ã€LME æ•°æ®æºæœªæ˜ç¡®        |
| è¡¨ç»“æ„è¿‡äºç®€å•   | éœ€è¦åŒºåˆ†ä¸åŒæ•°æ®é¢‘ç‡ï¼ˆtick/æ—¥çº¿/æœˆåº¦ï¼‰       |


---

## äºŒã€æ¨èçš„ä¼˜åŒ–æ¶æ„

```mermaid
flowchart TB
    subgraph sources [æ•°æ®æºå±‚]
        sina[æ–°æµªè´¢ç»<br/>å›½å†…æœŸè´§å®æ—¶]
        akshare[AkShare<br/>å›½å†…å¤–æœŸè´§/CPI/æ±½æŸ´æ²¹]
        yfinance[yfinance<br/>å›½é™…å¸‚åœºå¤‡ç”¨]
    end

    subgraph backend [åç«¯å±‚ Python FastAPI]
        scheduler[APScheduler<br/>å®šæ—¶ä»»åŠ¡è°ƒåº¦]
        fetcher[æ•°æ®é‡‡é›†æ¨¡å—]
        converter[å•ä½æ¢ç®—å™¨]
        calculator[æŒ‡æ ‡è®¡ç®—<br/>æº¢ä»·ç‡/ä»·å·®]
        api[REST API]
    end

    subgraph db [æ•°æ®åº“å±‚ SQLite]
        realtime[(realtime_prices<br/>åˆ†é’Ÿçº§å¿«ç…§)]
        daily[(daily_ohlc<br/>æ—¥Kçº¿)]
        macro[(macro_data<br/>CPI/æ²¹ä»·ç­‰æœˆåº¦æ•°æ®)]
    end

    subgraph frontend [å‰ç«¯å±‚ Next.js]
        dashboard[ä»ªè¡¨ç›˜]
        charts[ECharts å›¾è¡¨]
        table[æ•°æ®è¡¨æ ¼]
    end

    sina --> fetcher
    akshare --> fetcher
    yfinance --> fetcher
    scheduler --> fetcher
    fetcher --> converter --> calculator --> db
    db --> api --> frontend
```



---

## ä¸‰ã€å…³é”®æ”¹è¿›å»ºè®®

### 1. æ•°æ®æºï¼šå¼ºçƒˆæ¨èå¼•å…¥ AkShare

**ä¸ºä»€ä¹ˆï¼Ÿ**

- å¼€æº Python åº“ï¼Œå°è£…äº† 100+ æ•°æ®æº
- æ¶µç›–æ‚¨éœ€è¦çš„å‡ ä¹æ‰€æœ‰æ•°æ®ï¼šå›½å†…æœŸè´§ã€LMEã€CPIã€æ±½æŸ´æ²¹ä»·æ ¼
- æ¯”ç›´æ¥è°ƒç”¨æ–°æµªæ¥å£æ›´ç¨³å®šï¼Œæœ‰é”™è¯¯å¤„ç†

**ç¤ºä¾‹ä»£ç **ï¼š

```python
import akshare as ak

# å›½å†…æœŸè´§å®æ—¶è¡Œæƒ…ï¼ˆæ²ªé‡‘ã€æ²ªé“¶ã€æ²ªé“œã€æ²ªé“ã€åŸæ²¹ç­‰ï¼‰
futures_zh = ak.futures_zh_spot(symbol="AU0")  # æ²ªé‡‘ä¸»åŠ›

# LME é‡‘å±
lme_data = ak.futures_foreign_hist(symbol="LMEé“œ")

# ä¸­å›½ CPI
cpi_cn = ak.macro_china_cpi_monthly()

# ç¾å›½ CPI
cpi_us = ak.macro_usa_cpi_monthly()

# å›½å†…æ±½æŸ´æ²¹å†å²ä»·æ ¼
oil_price = ak.energy_oil_hist()
```

### 2. æ•°æ®åº“è¡¨ç»“æ„å»ºè®®

```sql
-- å®æ—¶/åˆ†é’Ÿçº§æ•°æ®ï¼ˆäº¤æ˜“æ—¶æ®µæ¯åˆ†é’Ÿé‡‡é›†ï¼‰
CREATE TABLE realtime_prices (
    id INTEGER PRIMARY KEY,
    timestamp DATETIME NOT NULL,
    symbol VARCHAR(20) NOT NULL,      -- å¦‚ 'SHFE.AU', 'LME.CU'
    name VARCHAR(50),                  -- å¦‚ 'æ²ªé‡‘ä¸»åŠ›'
    price DECIMAL(15,4) NOT NULL,
    price_cny DECIMAL(15,4),          -- æ¢ç®—åçš„äººæ°‘å¸ä»·æ ¼
    unit VARCHAR(10),                  -- åŸå§‹å•ä½ 'USD/oz', 'CNY/g'
    market VARCHAR(10),               -- 'CN', 'US', 'LME'
    UNIQUE(timestamp, symbol)
);

-- æ—¥Kçº¿æ•°æ®ï¼ˆæ°¸ä¹…ä¿å­˜ï¼‰
CREATE TABLE daily_ohlc (
    id INTEGER PRIMARY KEY,
    date DATE NOT NULL,
    symbol VARCHAR(20) NOT NULL,
    open DECIMAL(15,4),
    high DECIMAL(15,4),
    low DECIMAL(15,4),
    close DECIMAL(15,4),
    volume BIGINT,
    UNIQUE(date, symbol)
);

-- å®è§‚/ä½é¢‘æ•°æ®
CREATE TABLE macro_data (
    id INTEGER PRIMARY KEY,
    date DATE NOT NULL,
    indicator VARCHAR(50) NOT NULL,   -- 'CPI_CN', 'CPI_US', 'GASOLINE_CN'
    value DECIMAL(15,4),
    yoy_change DECIMAL(10,4),         -- åŒæ¯”å˜åŒ–
    UNIQUE(date, indicator)
);

-- è®¡ç®—æŒ‡æ ‡ï¼ˆæº¢ä»·ç‡ç­‰ï¼‰
CREATE TABLE spread_data (
    id INTEGER PRIMARY KEY,
    timestamp DATETIME NOT NULL,
    pair VARCHAR(50) NOT NULL,        -- 'GOLD_CN_US', 'COPPER_SHFE_LME'
    domestic_price DECIMAL(15,4),
    foreign_price DECIMAL(15,4),
    spread_rate DECIMAL(10,4),        -- æº¢ä»·ç‡ %
    UNIQUE(timestamp, pair)
);
```

### 3. åç«¯ç®€åŒ–ï¼šç”¨ APScheduler æ›¿ä»£ Celery

```python
from apscheduler.schedulers.background import BackgroundScheduler
from fastapi import FastAPI

app = FastAPI()
scheduler = BackgroundScheduler()

# äº¤æ˜“æ—¶æ®µæ¯åˆ†é’Ÿé‡‡é›†å›½å†…æœŸè´§
@scheduler.scheduled_job('cron', minute='*', hour='9-11,13-15', day_of_week='mon-fri')
def fetch_cn_futures():
    # é‡‡é›†é€»è¾‘
    pass

# æ¯å¤©æ”¶ç›˜åæ›´æ–°æ—¥Kçº¿
@scheduler.scheduled_job('cron', hour='16', minute='0')
def update_daily_ohlc():
    pass

# æ¯æœˆæ›´æ–° CPI æ•°æ®
@scheduler.scheduled_job('cron', day='15', hour='10')
def update_macro_data():
    pass

scheduler.start()
```

### 4. å•ä½æ¢ç®—æ¨¡å—è®¾è®¡

```python
CONVERSION_CONFIG = {
    'XAU': {
        'from_unit': 'USD/oz',
        'to_unit': 'CNY/g',
        'oz_to_gram': 31.1035,
    },
    'LME_CU': {
        'from_unit': 'USD/ton',
        'to_unit': 'CNY/ton',
    },
    # ... å…¶ä»–å“ç§
}

def convert_price(symbol: str, price: float, exchange_rate: float) -> float:
    """å°†å›½é™…ä»·æ ¼æ¢ç®—ä¸ºäººæ°‘å¸ä»·æ ¼"""
    config = CONVERSION_CONFIG.get(symbol)
    if not config:
        return price
    
    if 'oz_to_gram' in config:
        # é‡‘é“¶ï¼šç¾å…ƒ/ç›å¸ -> äººæ°‘å¸/å…‹
        return price * exchange_rate / config['oz_to_gram']
    else:
        # é“œé“ç­‰ï¼šç¾å…ƒ/å¨ -> äººæ°‘å¸/å¨
        return price * exchange_rate
```

---

## å››ã€æ•°æ®æºå®Œæ•´æ˜ å°„


| å“ç§               | æ•°æ®æº              | AkShare æ¥å£                         | å¤‡æ³¨     |
| ---------------- | ---------------- | ---------------------------------- | ------ |
| XAU/USD, XAG/USD | AkShare/yfinance | `futures_foreign_hist`             | å›½é™…é‡‘é“¶   |
| SHFE é»„é‡‘/ç™½é“¶       | AkShare          | `futures_zh_spot("AU0")`           | æ²ªé‡‘æ²ªé“¶ä¸»åŠ› |
| LME é“œ/é“          | AkShare          | `futures_foreign_hist("LMEé“œ")`     | ä¼¦æ•¦é‡‘å±   |
| SHFE æ²ªé“œ/æ²ªé“       | AkShare          | `futures_zh_spot("CU0")`           | ä¸ŠæœŸæ‰€    |
| Brent åŸæ²¹         | AkShare          | `futures_foreign_hist("å¸ƒä¼¦ç‰¹åŸæ²¹")`    | ICE    |
| å¤©ç„¶æ°”              | AkShare          | `futures_foreign_hist("NYMEXå¤©ç„¶æ°”")` | NYMEX  |
| INE åŸæ²¹           | AkShare          | `futures_zh_spot("SC0")`           | ä¸Šæµ·èƒ½æº   |
| PTA/ç”²é†‡           | AkShare          | `futures_zh_spot("TA0"/"MA0")`     | éƒ‘å•†æ‰€    |
| CBOT å¤§è±†/ç‰ç±³       | AkShare          | `futures_foreign_hist("CBOTå¤§è±†")`   | èŠåŠ å“¥    |
| DCE è±†ç²•/ç‰ç±³        | AkShare          | `futures_zh_spot("M0"/"C0")`       | å¤§å•†æ‰€    |
| DCE ç”ŸçŒª           | AkShare          | `futures_zh_spot("LH0")`           | å¤§å•†æ‰€    |
| ä¸­å›½ CPI           | AkShare          | `macro_china_cpi_monthly()`        | æœˆåº¦     |
| ç¾å›½ CPI           | AkShare          | `macro_usa_cpi_monthly()`          | æœˆåº¦     |
| æ±½æŸ´æ²¹é›¶å”®ä»·           | AkShare          | `energy_oil_hist()`                | å‘æ”¹å§”è°ƒä»·  |


---

## äº”ã€å‰ç«¯é¡µé¢ç»“æ„å»ºè®®

```
/                      # ä»ªè¡¨ç›˜é¦–é¡µ
â”œâ”€â”€ é¡¶éƒ¨æŒ‡æ ‡å¡ç‰‡        # å…³é”®å“ç§å®æ—¶ä»·æ ¼ + æ¶¨è·Œå¹…
â”œâ”€â”€ æº¢ä»·ç‡ä»ªè¡¨ç›˜        # Gauge å›¾ï¼šé‡‘/é“œ/æ²¹çš„å†…å¤–ä»·å·®
â”œâ”€â”€ å“ç§è½®åŠ¨çƒ­åŠ›å›¾      # å„å“ç§è¿‘æœŸæ¶¨è·Œçƒ­åŠ›å›¾
â””â”€â”€ å¿«é€Ÿè·³è½¬å…¥å£

/metals               # é‡‘å±æ¿å—
â”œâ”€â”€ è´µé‡‘å±ï¼ˆé‡‘é“¶ï¼‰
â””â”€â”€ æœ‰è‰²é‡‘å±ï¼ˆé“œé“ï¼‰

/energy               # èƒ½æºæ¿å—
â”œâ”€â”€ åŸæ²¹ï¼ˆå¸ƒä¼¦ç‰¹/INEï¼‰
â”œâ”€â”€ å¤©ç„¶æ°”
â””â”€â”€ åŒ–å·¥ï¼ˆPTA/ç”²é†‡ï¼‰

/agriculture          # å†œäº§å“æ¿å—
â”œâ”€â”€ æ²¹è„‚æ²¹æ–™ï¼ˆå¤§è±†/è±†ç²•ï¼‰
â”œâ”€â”€ è°·ç‰©ï¼ˆç‰ç±³ï¼‰
â””â”€â”€ ç”ŸçŒª

/macro                # å®è§‚æ•°æ®
â”œâ”€â”€ ä¸­ç¾ CPI å¯¹æ¯”å›¾
â””â”€â”€ æ±½æŸ´æ²¹è°ƒä»·å†å²

/settings             # è®¾ç½®é¡µ
â””â”€â”€ æ•°æ®åˆ·æ–°é¢‘ç‡é…ç½®
```

---

## å…­ã€é£é™©å’Œæ³¨æ„äº‹é¡¹

1. **æ¥å£é™æµ**ï¼šAkShare åº•å±‚è°ƒç”¨çš„æ•°æ®æºå¯èƒ½æœ‰é¢‘ç‡é™åˆ¶ï¼Œå»ºè®®è®¾ç½®åˆç†çš„é‡‡é›†é—´éš”ï¼ˆ1-2åˆ†é’Ÿï¼‰
2. **äº¤æ˜“æ—¶æ®µ**ï¼šå›½å†…æœŸè´§äº¤æ˜“æ—¶æ®µåŒ…æ‹¬å¤œç›˜ï¼ˆ21:00-02:30ï¼‰ï¼Œè°ƒåº¦ä»»åŠ¡éœ€è¦†ç›–
3. **æ•°æ®æ¸…æ´—**ï¼šä¸åŒæºçš„æ•°æ®æ ¼å¼ä¸ä¸€è‡´ï¼Œéœ€è¦ç»Ÿä¸€å¤„ç†
4. **å†å²æ•°æ®åˆå§‹åŒ–**ï¼šé¦–æ¬¡è¿è¡Œéœ€è¦æ‰¹é‡å¯¼å…¥å†å²æ•°æ®ï¼Œå»ºè®®å•ç‹¬å†™è„šæœ¬

---

## ä¸ƒã€ç›®å½•ç»“æ„å»ºè®®

```
å¤§å®—æˆ˜æƒ…å®¤/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ main.py           # FastAPI å…¥å£
â”‚   â”‚   â”œâ”€â”€ scheduler.py      # å®šæ—¶ä»»åŠ¡
â”‚   â”‚   â”œâ”€â”€ fetchers/         # å„æ•°æ®æºé‡‡é›†å™¨
â”‚   â”‚   â”œâ”€â”€ converters/       # å•ä½æ¢ç®—
â”‚   â”‚   â”œâ”€â”€ models/           # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ api/              # API è·¯ç”±
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â””â”€â”€ commodities.db    # SQLite æ•°æ®åº“
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ charts/           # ECharts å°è£…
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ Dockerfile
â””â”€â”€ docker-compose.yml
```

---

## å…«ã€æ ¸å¿ƒåŠŸèƒ½ï¼šæº¢ä»·ç‡è®¡ç®—å™¨ (Calculator)

è¿™æ˜¯å‘ç°å¥—åˆ©æœºä¼šçš„æ ¸å¿ƒæ¨¡å—ï¼Œ**æ‰€æœ‰æŒ‡æ ‡å…¨éƒ¨ç”±å…¬å¼è‡ªåŠ¨è®¡ç®—**ï¼Œæ— éœ€æ‰‹åŠ¨å¡«å†™ã€‚

### æ±‡ç‡æ•°æ®æºï¼ˆåŒä¿é™©ï¼‰

```python
import akshare as ak

def get_exchange_rate() -> float:
    """è·å–ç¾å…ƒå…‘äººæ°‘å¸æ±‡ç‡ï¼ŒåŒæ•°æ®æºä¿éšœ"""
    try:
        # ä¸»æ•°æ®æºï¼šAkShare å®æ—¶æ±‡ç‡
        df = ak.currency_boc_sina(symbol="ç¾å…ƒ")
        return float(df.iloc[-1]['ä¸­è¡ŒæŠ˜ç®—ä»·'])
    except Exception:
        # å¤‡ç”¨æ•°æ®æºï¼šå¤®è¡Œä¸­é—´ä»·
        df = ak.macro_china_fx_spot()
        return float(df[df['è´§å¸'] == 'ç¾å…ƒ']['ä¸­é—´ä»·'].iloc[-1])
```

### è®¡ç®—å…¬å¼

```python
# === åŸºç¡€æ¢ç®— ===
exchange_rate = get_exchange_rate()  # å¦‚ 7.25

# === ç†è®ºä»·æ ¼è®¡ç®— ===
# é»„é‡‘ï¼šä¼¦æ•¦é‡‘(USD/oz) -> äººæ°‘å¸/å…‹
theoretical_gold_cny = london_gold_usd / 31.1035 * exchange_rate

# ç™½é“¶ï¼šä¼¦æ•¦é“¶(USD/oz) -> äººæ°‘å¸/åƒå…‹
theoretical_silver_cny = london_silver_usd / 31.1035 * exchange_rate * 1000

# é“œï¼šLMEé“œ(USD/ton) -> äººæ°‘å¸/å¨
theoretical_copper_cny = lme_copper_usd * exchange_rate

# é“ï¼šLMEé“(USD/ton) -> äººæ°‘å¸/å¨
theoretical_aluminum_cny = lme_aluminum_usd * exchange_rate

# === æº¢ä»·ç‡è®¡ç®— ===
# æº¢ä»·ç‡ = (å®é™…å›½å†…ä»· - ç†è®ºä»·) / ç†è®ºä»· Ã— 100%
gold_premium = (shfe_gold - theoretical_gold_cny) / theoretical_gold_cny * 100
silver_premium = (shfe_silver - theoretical_silver_cny) / theoretical_silver_cny * 100
copper_premium = (shfe_copper - theoretical_copper_cny) / theoretical_copper_cny * 100
aluminum_premium = (shfe_aluminum - theoretical_aluminum_cny) / theoretical_aluminum_cny * 100

# === æ¯”å€¼æŒ‡æ ‡ ===
# é‡‘é“¶æ¯” = é‡‘ä»· / é“¶ä»·ï¼ˆå†å²å‡å€¼çº¦ 60-80ï¼‰
gold_silver_ratio = london_gold_usd / london_silver_usd

# é“œé‡‘æ¯” = é“œä»· / é‡‘ä»·ï¼ˆç»æµæ¸©åº¦è®¡ï¼Œæ¯”å€¼é«˜=ç»æµå¥½ï¼Œæ¯”å€¼ä½=é¿é™©æƒ…ç»ªï¼‰
copper_gold_ratio = lme_copper_usd / london_gold_usd
```

### ä¿¡å·è§£è¯»è§„åˆ™ï¼ˆå‰ç«¯å¯è§†åŒ–ï¼‰


| æŒ‡æ ‡    | é˜ˆå€¼    | ä¿¡å·  | è§£è¯»           |
| ----- | ----- | --- | ------------ |
| é»„é‡‘æº¢ä»·ç‡ | > +2% | çº¢ç¯  | å›½å†…æŠ¢é‡‘ï¼Œææ…Œæƒ…ç»ªæµ“åš  |
| é»„é‡‘æº¢ä»·ç‡ | < -2% | ç»¿ç¯  | å›½å†…é‡‘ä»·åä½ï¼Œå¯èƒ½æœ‰æœºä¼š |
| é“œæº¢ä»·ç‡  | < -5% | ç»¿ç¯  | å›½å†…é“œä¾¿å®œï¼Œåšå¤šæœºä¼š   |
| é“œæº¢ä»·ç‡  | > +5% | çº¢ç¯  | å›½å†…é“œæº¢ä»·è¿‡é«˜      |
| é‡‘é“¶æ¯”   | > 80  | è­¦ç¤º  | é¿é™©æƒ…ç»ªé«˜æ¶¨ï¼Œç™½é“¶è¢«ä½ä¼° |
| é‡‘é“¶æ¯”   | < 60  | è­¦ç¤º  | ç™½é“¶å¯èƒ½è¢«é«˜ä¼°      |
| é“œé‡‘æ¯”   | ä¸Šå‡è¶‹åŠ¿  | ğŸ“ˆ  | ç»æµé¢„æœŸæ”¹å–„       |
| é“œé‡‘æ¯”   | ä¸‹é™è¶‹åŠ¿  | ğŸ“‰  | ç»æµé¢„æœŸæ¶åŒ–ï¼Œé¿é™©å‡æ¸©  |


### åç«¯ API æ¥å£

```python
@app.get("/api/calculator")
def get_calculator_data():
    """è¿”å›æº¢ä»·ç‡è®¡ç®—å™¨çš„å®Œæ•´æ•°æ®"""
    return {
        "timestamp": "2026-01-29 15:30:00",
        "exchange_rate": 7.25,
        "gold": {
            "london_usd_oz": 2650.50,
            "shfe_cny_g": 620.80,
            "theoretical_cny_g": 618.45,
            "premium_rate": 0.38  # %
        },
        "silver": {...},
        "copper": {...},
        "aluminum": {...},
        "ratios": {
            "gold_silver": 84.95,
            "copper_gold": 3.47
        },
        "signals": {
            "gold_premium": "normal",  # high/low/normal
            "copper_premium": "normal",
            "gold_silver_ratio": "high_alert",
            "economic_sentiment": "neutral"
        }
    }
```

---

## ä¹ã€å½’ä¸€åŒ–å¯¹æ¯”å›¾è¡¨

å°†ä¸åŒå“ç§çš„ä»·æ ¼å½’ä¸€åŒ–åˆ°åŒä¸€åŸºå‡†ï¼ˆå¦‚ä»¥æŸæ—¥ä¸º 100ï¼‰ï¼Œä¾¿äºå¯¹æ¯”èµ°åŠ¿ã€‚

### å½’ä¸€åŒ–å…¬å¼

```python
# ä»¥èµ·å§‹æ—¥æ”¶ç›˜ä»·ä¸ºåŸºå‡† 100
normalized_price = current_price / base_price * 100

# ç¤ºä¾‹ï¼š2025-01-01 ä¸ºåŸºå‡†æ—¥
# é»„é‡‘ä» 600 æ¶¨åˆ° 620 â†’ å½’ä¸€åŒ–å€¼ = 620/600*100 = 103.33
```

### å›¾è¡¨åˆ†ç»„

```mermaid
flowchart LR
    subgraph chart1 [è´µé‡‘å±å½’ä¸€åŒ–]
        gold[æ²ªé‡‘]
        silver[æ²ªé“¶]
        goldus[ä¼¦æ•¦é‡‘]
    end
    
    subgraph chart2 [æœ‰è‰²é‡‘å±å½’ä¸€åŒ–]
        copper[æ²ªé“œ]
        aluminum[æ²ªé“]
        lmecu[LMEé“œ]
    end
    
    subgraph chart3 [èƒ½æºå½’ä¸€åŒ–]
        brent[å¸ƒä¼¦ç‰¹åŸæ²¹]
        ine[INEåŸæ²¹]
        gas[å¤©ç„¶æ°”]
    end
    
    subgraph chart4 [å†œäº§å“å½’ä¸€åŒ–]
        soybean[CBOTå¤§è±†]
        corn[CBOTç‰ç±³]
        meal[DCEè±†ç²•]
        dcecorn[DCEç‰ç±³]
    end
```



### åç«¯ API

```python
@app.get("/api/normalized")
def get_normalized_data(
    group: str,  # "precious_metals", "base_metals", "energy", "agriculture"
    base_date: str = None,  # åŸºå‡†æ—¥æœŸï¼Œé»˜è®¤1å¹´å‰
    period: str = "1y"  # 1m, 3m, 6m, 1y, 3y, all
):
    """è¿”å›å½’ä¸€åŒ–åçš„å¤šå“ç§æ•°æ®"""
    return {
        "base_date": "2025-01-29",
        "base_value": 100,
        "series": [
            {"name": "æ²ªé‡‘", "symbol": "SHFE.AU", "data": [[timestamp, value], ...]},
            {"name": "æ²ªé“¶", "symbol": "SHFE.AG", "data": [...]},
            {"name": "ä¼¦æ•¦é‡‘", "symbol": "XAU", "data": [...]}
        ]
    }
```

---

## åã€æ•°æ®å¯¼å‡ºåŠŸèƒ½

### å¯¼å‡ºæ ¼å¼

- **CSV**ï¼šé€šç”¨æ ¼å¼ï¼ŒExcel/Python/R éƒ½èƒ½è¯»å–
- **Excel**ï¼šå¸¦æ ¼å¼çš„ .xlsx æ–‡ä»¶

### å¯¼å‡ºå†…å®¹é€‰é¡¹

1. **å®æ—¶å¿«ç…§**ï¼šå½“å‰æ‰€æœ‰å“ç§çš„æœ€æ–°ä»·æ ¼
2. **å†å²æ•°æ®**ï¼šæŒ‡å®šå“ç§ã€æŒ‡å®šæ—¶é—´èŒƒå›´çš„æ—¥Kçº¿
3. **æº¢ä»·ç‡å†å²**ï¼šæº¢ä»·ç‡è®¡ç®—å™¨çš„å†å²è®°å½•
4. **å®è§‚æ•°æ®**ï¼šCPIã€æ±½æŸ´æ²¹ä»·æ ¼ç­‰

### åç«¯ API

```python
from fastapi.responses import StreamingResponse
import pandas as pd
import io

@app.get("/api/export")
def export_data(
    type: str,  # "snapshot", "history", "premium", "macro"
    format: str = "csv",  # "csv" or "xlsx"
    symbols: str = None,  # é€—å·åˆ†éš”çš„å“ç§ä»£ç 
    start_date: str = None,
    end_date: str = None
):
    """å¯¼å‡ºæ•°æ®ä¸º CSV æˆ– Excel"""
    df = fetch_export_data(type, symbols, start_date, end_date)
    
    if format == "csv":
        buffer = io.StringIO()
        df.to_csv(buffer, index=False, encoding='utf-8-sig')
        return StreamingResponse(...)
    else:
        buffer = io.BytesIO()
        df.to_excel(buffer, index=False)
        return StreamingResponse(...)
```

---

## åä¸€ã€æ›´æ–°åçš„é¡µé¢ç»“æ„

```
/                           # ä»ªè¡¨ç›˜é¦–é¡µ
â”œâ”€â”€ é¡¶éƒ¨æŒ‡æ ‡å¡ç‰‡             # å…³é”®å“ç§å®æ—¶ä»·æ ¼ + æ¶¨è·Œå¹…
â”œâ”€â”€ æº¢ä»·ç‡ä»ªè¡¨ç›˜             # Gauge å›¾ï¼šé‡‘/é“œçš„å†…å¤–ä»·å·®
â”œâ”€â”€ ä¿¡å·ç¯é¢æ¿              # æº¢ä»·ç‡ä¿¡å·è§£è¯»
â””â”€â”€ å¿«é€Ÿè·³è½¬å…¥å£

/calculator                 # æº¢ä»·ç‡è®¡ç®—å™¨ï¼ˆæ ¸å¿ƒé¡µé¢ï¼‰
â”œâ”€â”€ å®æ—¶æ•°æ®è¡¨æ ¼            # æ‰€æœ‰å“ç§çš„æº¢ä»·ç‡ã€æ¯”å€¼
â”œâ”€â”€ ä¿¡å·è§£è¯»é¢æ¿            # çº¢ç»¿ç¯ + æ–‡å­—è¯´æ˜
â””â”€â”€ å†å²æº¢ä»·ç‡èµ°åŠ¿å›¾         # å¯é€‰æ‹©ä¸åŒå“ç§

/charts                     # å½’ä¸€åŒ–å›¾è¡¨é¡µ
â”œâ”€â”€ è´µé‡‘å±å½’ä¸€åŒ–            # é‡‘/é“¶/ä¼¦æ•¦é‡‘
â”œâ”€â”€ æœ‰è‰²é‡‘å±å½’ä¸€åŒ–          # é“œ/é“/LME
â”œâ”€â”€ èƒ½æºå½’ä¸€åŒ–              # åŸæ²¹/å¤©ç„¶æ°”
â””â”€â”€ å†œäº§å“å½’ä¸€åŒ–            # å¤§è±†/ç‰ç±³/è±†ç²•

/metals                     # é‡‘å±è¯¦æƒ…é¡µ
/energy                     # èƒ½æºè¯¦æƒ…é¡µ
/agriculture                # å†œäº§å“è¯¦æƒ…é¡µ
/macro                      # å®è§‚æ•°æ®é¡µ

/export                     # æ•°æ®å¯¼å‡ºé¡µ
â”œâ”€â”€ é€‰æ‹©å¯¼å‡ºç±»å‹
â”œâ”€â”€ é€‰æ‹©å“ç§
â”œâ”€â”€ é€‰æ‹©æ—¶é—´èŒƒå›´
â””â”€â”€ ä¸‹è½½æŒ‰é’®
```

---

## åäºŒã€ç¡®è®¤çš„éœ€æ±‚æ¸…å•

- ä¸éœ€è¦ç”¨æˆ·è®¤è¯
- éœ€è¦æ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼ˆCSV/Excelï¼‰
- æš‚ä¸éœ€è¦ä»·æ ¼é¢„è­¦
- éœ€è¦å½’ä¸€åŒ–å¯¹æ¯”å›¾è¡¨ï¼ˆé‡‘é“¶/èƒ½æº/å†œäº§å“åˆ†ç»„ï¼‰
- éœ€è¦æº¢ä»·ç‡è‡ªåŠ¨è®¡ç®—å™¨ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
- éœ€è¦é‡‘é“¶æ¯”ã€é“œé‡‘æ¯”ç­‰è¡ç”ŸæŒ‡æ ‡
- éœ€è¦ä¿¡å·è§£è¯»ï¼ˆçº¢ç»¿ç¯æç¤ºï¼‰

